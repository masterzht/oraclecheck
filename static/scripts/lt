
if [ "$1" = "dg_info" -o "$1" = "dg" ]; then

  ltsql -p $2 -x -c"
   SELECT application_name                            AS appname,
        usename,
        coalesce(client_addr::TEXT, 'localhost')    AS address,
        pid::TEXT,
        client_port,
        CASE state
            WHEN 'streaming' THEN 0
            WHEN 'startup' THEN 1
            WHEN 'catchup' THEN 2
            WHEN 'backup' THEN 3
            WHEN 'stopping' THEN 4
            ELSE -1 END                             AS state,
        CASE sync_state
            WHEN 'async' THEN 0
            WHEN 'potential' THEN 1
            WHEN 'sync' THEN 2
            WHEN 'quorum' THEN 3
            ELSE -1 END                             AS sync_state,
        sync_priority,
        backend_xmin::TEXT::BIGINT                  AS backend_xmin,
        current.lsn - '0/0'                         AS lsn,
        current.lsn - sent_lsn                      AS sent_diff,
        current.lsn - write_lsn                     AS write_diff,
        current.lsn - flush_lsn                     AS flush_diff,
        current.lsn - replay_lsn                    AS replay_diff,
        sent_lsn - '0/0'                            AS sent_lsn,
        write_lsn - '0/0'                           AS write_lsn,
        flush_lsn - '0/0'                           AS flush_lsn,
        replay_lsn - '0/0'                          AS replay_lsn,
        coalesce(extract(EPOCH FROM write_lag), 0)  AS write_lag,
        coalesce(extract(EPOCH FROM flush_lag), 0)  AS flush_lag,
        coalesce(extract(EPOCH FROM replay_lag), 0) AS replay_lag,
        extract(EPOCH FROM current_timestamp)       AS 'time',
        extract(EPOCH FROM backend_start)           AS launch_time,
        extract(EPOCH FROM reply_time)              AS reply_time
 FROM pg_stat_replication,
      (SELECT CASE WHEN pg_is_in_recovery() THEN pg_last_wal_replay_lsn() ELSE pg_current_wal_lsn() END AS lsn) current;
      select * from pg_settings where name ='synchronous_commit';
  "
fi


######################################

 ## lt_dump -Fp -s -t '$2' -dem -p5432 -f .  $2.sql -v
